// Prisma schema for Media Scraper

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// User authentication
model User {
  id           Int          @id @default(autoincrement())
  username     String       @unique @db.VarChar(255)
  passwordHash String       @map("password_hash") @db.VarChar(255)
  createdAt    DateTime     @default(now()) @map("created_at")
  scrapeJobs   ScrapeJob[]

  @@map("users")
  @@index([username])
}

// Scraping job tracking
model ScrapeJob {
  id          Int       @id @default(autoincrement())
  userId      Int?      @map("user_id")
  urls        String[]  // Array of URLs to scrape
  status      String    @default("pending") @db.VarChar(50) // pending, processing, completed, failed
  createdAt   DateTime  @default(now()) @map("created_at")
  completedAt DateTime? @map("completed_at")
  user        User?     @relation(fields: [userId], references: [id])
  media       Media[]

  @@map("scrape_jobs")
  @@index([status])
  @@index([createdAt(sort: Desc)])
  @@index([userId])
}

// Media items (images and videos)
model Media {
  id        Int       @id @default(autoincrement())
  jobId     Int       @map("job_id")
  sourceUrl String    @map("source_url") @db.Text // The webpage URL it was scraped from
  mediaUrl  String    @map("media_url") @db.Text // The actual image/video URL
  type      String    @db.VarChar(10) // 'image' or 'video'
  title     String?   @db.Text // For search functionality
  createdAt DateTime  @default(now()) @map("created_at")
  job       ScrapeJob @relation(fields: [jobId], references: [id], onDelete: Cascade)

  @@map("media")
  @@index([type])
  @@index([createdAt(sort: Desc)])
  @@index([jobId])
  @@index([sourceUrl])
}
